/* This file is generated by tdr. */
/* No manual modification is permitted. */

/* creation time: Thu Dec 03 16:03:11 2015 */
/* tdr version: 2.5.1, build at 20120623 */

#ifndef _TDR_TIME_H_
#define _TDR_TIME_H_

#include "TdrPal.h"
#include "TdrBuf.h"
#include "TdrError.h"

namespace tsf4g_tdr
{


class TdrTime
{
    private:
        int16_t nHour;
        uint8_t bMin;
        uint8_t bSec;

    public:
        TdrTime(struct tm& src)
        {
            nHour = (short)src.tm_hour;
            bMin = (unsigned char)src.tm_min;
            bSec = (unsigned char)src.tm_sec;
        }

        TdrTime(tdr_time_t src)
        {
            nHour = *(int16_t*)(void*)&src;
            bMin = *(uint8_t*)((char*)&src + 2);
            bSec = *(uint8_t*)((char*)&src + 3);
        }

        void toTm(struct tm& dest) const
        {
            dest.tm_hour = nHour;
            dest.tm_min  = bMin;
            dest.tm_sec  = bSec;
        }

        operator tdr_time_t () const
        {
            tdr_time_t ret;

            *(int16_t*)(void*)&ret = nHour;
            *(uint8_t*)((char*)&ret + 2) = bMin;
            *(uint8_t*)((char*)&ret + 3) = bSec;

            return ret;
        }

        TdrError::ErrorType print2Buf(TdrWriteBuf& dest) const
        {
            return dest.textize("%02d:%02d:%02d", nHour, bMin, bSec);
        }

        TdrError::ErrorType print2Buf(char* dest, size_t size, int *usedSize) const
        {
            if (NULL == dest || size <= 0)
            {
                return TdrError::TDR_ERR_NULL_POINTER_PARAMETER;
            }
            *usedSize = tdr_cpp_snprintf(dest, size, "%02d:%02d:%02d", nHour, bMin, bSec);

            return TdrError::TDR_NO_ERROR;
        }

        bool operator < (const TdrTime& right) const
        {
            if (this->nHour > right.nHour)
            {
                return false;
            } else if (this->nHour < right.nHour)
            {
                return true;
            }

            if (this->bMin > right.bMin)
            {
                return false;
            } else if (this->bMin < right.bMin)
            {
                return true;
            }

            if (this->bSec > right.bSec)
            {
                return false;
            } else if (this->bSec < right.bSec)
            {
                return true;
            }

            return false;
        }

        bool isValid() const
        {
            if ((-999 > nHour) || (999 < nHour))
            {
                return false;
            }

            if ((59 < bMin))
            {
                return false;
            }

            if ((59 < bSec))
            {
                return false;
            }

            return true;
        }
};

class TdrDate
{
    private:
        int16_t nYear;
        uint8_t bMon;
        uint8_t bDay;

    public:
        TdrDate(struct tm& src)
        {
            nYear = (short)(src.tm_year + 1900);
            bMon = (unsigned char)src.tm_mon + 1;
            bDay = (unsigned char)src.tm_mday;
        }

        TdrDate(tdr_date_t src)
        {
            nYear = *(int16_t*)(void*)&src;
            bMon = *(uint8_t*)((char*)&src + 2);
            bDay = *(uint8_t*)((char*)&src + 3);
        }

        void toTm(struct tm& dest) const
        {
            dest.tm_year = nYear - 1900;
            dest.tm_mon  = bMon - 1;
            dest.tm_mday = bDay;
        }

        operator tdr_date_t () const
        {
            tdr_date_t ret;

            *(int16_t*)(void*)&ret = nYear;
            *(uint8_t*)((char*)&ret + 2) = bMon;
            *(uint8_t*)((char*)&ret + 3) = bDay;

            return ret;
        }

        TdrError::ErrorType print2Buf(TdrWriteBuf& dest) const
        {
            return dest.textize("%4d-%02d-%02d", nYear, bMon, bDay);
        }

        TdrError::ErrorType print2Buf(char* dest, size_t size, int *usedSize) const
        {
            if (NULL == dest || size <= 0)
            {
                return TdrError::TDR_ERR_NULL_POINTER_PARAMETER;
            }
            *usedSize = tdr_cpp_snprintf(dest, size, "%4d-%02d-%02d", nYear, bMon, bDay);

            return TdrError::TDR_NO_ERROR;
        }

        bool operator < (const TdrDate& right) const
        {
            if (this->nYear > right.nYear)
            {
                return false;
            } else if (this->nYear < right.nYear)
            {
                return true;
            }

            if (this->bMon > right.bMon)
            {
                return false;
            } else if (this->bMon < right.bMon)
            {
                return true;
            }

            if (this->bDay > right.bDay)
            {
                return false;
            } else if (this->bDay < right.bDay)
            {
                return true;
            }

            return false;
        }

        bool isValid() const;
};

class TdrDateTime
{
    private:
        TdrDate tdrDate;
        TdrTime tdrTime;

    public:
        TdrDateTime(struct tm& src) : tdrDate(src), tdrTime(src) {}

        TdrDateTime(tdr_datetime_t src)
            : tdrDate(*(tdr_date_t*)(void*)&src), tdrTime(*(tdr_time_t*)((char*)&src + 4)) {}

        operator tdr_datetime_t () const
        {
            tdr_datetime_t ret;

            *(tdr_date_t*)(void*)&ret = tdrDate;
            *(tdr_time_t*)((char*)&ret + 4) = tdrTime;

            return ret;
        }

        void toTm(struct tm& dest) const
        {
            tdrDate.toTm(dest);
            tdrTime.toTm(dest);
        }

        TdrError::ErrorType print2Buf(TdrWriteBuf& dest) const
        {
            TdrError::ErrorType ret = TdrError::TDR_NO_ERROR;

            ret = tdrDate.print2Buf(dest);

            if (TdrError::TDR_NO_ERROR == ret)
            {
                ret = dest.writeChar(' ');
            }

            if (TdrError::TDR_NO_ERROR == ret)
            {
                ret = tdrTime.print2Buf(dest);
            }

            return ret;
        }

        TdrError::ErrorType print2Buf(char* dest, size_t size, int *usedSize) const
        {
            TdrError::ErrorType ret = TdrError::TDR_NO_ERROR;

            if (NULL == dest || size <= 0)
            {
                return TdrError::TDR_ERR_NULL_POINTER_PARAMETER;
            }

            ret = tdrDate.print2Buf(dest, size, usedSize);
            if (ret != TdrError::TDR_NO_ERROR)
            {
                return ret;
            }

            if (*usedSize >= 0 && *usedSize <= (int)size )
            {
                dest[(*usedSize)++] = ' ';
            }

            if (*usedSize >= 0 && *usedSize <= (int)size )
            {
                ret = tdrTime.print2Buf(dest + *usedSize, size - *usedSize, usedSize);
            }

            return ret;
        }


        bool operator < (const TdrDateTime& right) const
        {
            if (this->tdrDate < right.tdrDate)
            {
                return true;
            } else if (right.tdrDate < this->tdrDate)
            {
                return false;
            }

            if (this->tdrTime < right.tdrTime)
            {
                return true;
            } else if (right.tdrTime < this->tdrTime)
            {
                return false;
            }

            return false;
        }

        bool isValid() const
        {
            return tdrDate.isValid() && tdrTime.isValid();
        }
};

}
#endif
